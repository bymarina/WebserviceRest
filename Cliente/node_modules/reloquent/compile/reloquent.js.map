{
"version":3,
"file":"compile/reloquent.js",
"lineCount":107,
"mappings":"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",
"sources":["node_modules/readline/index.js","node_modules/promto/src/index.js","src/lib/ask.js","src/lib/ask-questions.js","src/depack.js","src/index.js"],
"sourcesContent":["export default readline\nexport const {\n  Interface,\n  clearLine,\n  clearScreenDown,\n  createInterface,\n  cursorTo,\n  emitKeypressEvents,\n  moveCursor,\n} = readline","function createTimeout(desc, timeout, cb) {\n  return setTimeout(() => {\n    const message = `${desc ? desc : 'Promise'} has timed out after ${timeout}ms`\n    const err = new Error(message)\n    err.stack = `Error: ${err.message}`\n    cb(err)\n  }, timeout)\n}\n\nfunction makeTimeoutPromise(desc, timeout) {\n  let to\n  const promise = new Promise((_, reject) => {\n    to = createTimeout(desc, timeout, reject)\n  })\n  return { timeout: to, promise }\n}\n\n/**\n * Create a promise which will be rejected after a timeout.\n * @param {!Promise<T>} promise A promise to race with\n * @param {number} timeout Timeout in ms after which to reject\n * @param {string} [desc] Description of a promise to be printed in error\n * @returns {!Promise<T>} A promise with a timeout\n * @template T\n */\nexport default async function createPromiseWithTimeout(promise, timeout, desc) {\n  if (!(promise instanceof Promise))\n    throw new Error('Promise expected')\n  if (!timeout)\n    throw new Error('Timeout must be a number')\n  if (timeout < 0)\n    throw new Error('Timeout cannot be negative')\n\n  const { promise: toPromise, timeout: to } = makeTimeoutPromise(desc, timeout)\n  try {\n    return await Promise.race([\n      promise,\n      toPromise,\n    ])\n  } finally {\n    clearTimeout(to)\n  }\n}","import { createInterface } from 'readline'\r\nimport promto from 'promto'\r\n\r\n/**\r\n * Ask user a question and wait for an answer.\r\n * @param {string} question Question to present to the user.\r\n * @param {{ password: (boolean| undefined), timeout: (number|undefined), input: (stream.Readable|NodeJS.ReadStream|undefined), output: (stream.Writable|NodeJS.WriteStream|undefined) }} options The options.\r\n */\r\nexport default function ask(question, options = {}) {\r\n  const {\r\n    timeout,\r\n    password = false,\r\n    output = process.stdout,\r\n    input = process.stdin,\r\n    ...rest\r\n  } = options\r\n  const rl = createInterface(/** @type {!readline.ReadLineOptions} */ ({\r\n    input,\r\n    output,\r\n    ...rest,\r\n  }))\r\n  if (password) {\r\n    /**\r\n     * Undocumented API.\r\n     * @type {!NodeJS.WriteStream}\r\n     * @suppress {checkTypes}\r\n     */\r\n    const o = rl['output']\r\n    /**\r\n     * Undocumented API.\r\n     * @suppress {checkTypes}\r\n     */\r\n    rl['_writeToOutput'] = (s) => {\r\n      if (['\\r\\n', '\\n', '\\r'].includes(s))\r\n        return o.write(s)\r\n\r\n      const v = s.split(question)\r\n      if (v.length == '2') {\r\n        o.write(question)\r\n        o.write('*'.repeat(v[1].length))\r\n      } else {\r\n        o.write('*')\r\n      }\r\n    }\r\n  }\r\n  const p = new Promise(rl.question.bind(rl, question))\r\n\r\n  const promise = timeout\r\n    ? promto(p, timeout, `reloquent: ${question}`)\r\n    : p\r\n  /**\r\n   * @suppress {checkTypes}\r\n   */\r\n  rl['promise'] = tryPromise(promise, rl)\r\n  return rl\r\n}\r\n\r\nconst tryPromise = async (promise, rl) => {\r\n  try {\r\n    const res = await promise\r\n    return res\r\n  } finally {\r\n    rl.close()\r\n  }\r\n}\r\n\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('stream').Readable} stream.Readable\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('stream').Writable} stream.Writable\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('readline').ReadLineOptions} readline.ReadLineOptions\r\n */","import ask from './ask'\r\n\r\n/**\r\n * Color foreground with grey\r\n * @param {string} t\r\n */\r\nexport function c(t) {\r\n  return `\\x1b[90m${t}\\x1b[0m`\r\n}\r\n\r\n/**\r\n * Ask a set of questions.\r\n * @param {_reloquent.Questions} questions An object with questions as values\r\n * @param {number} [timeout] How long to wait before answer\r\n * @returns {!Promise<!Object<string, string>>} A promise where keys from the questions object are validated, assigned default values if required, and populated with answers. Validation function should either throw or return nothing, or throw an error.\r\n */\r\nexport default async function askQuestions(questions, timeout) {\r\n  if (typeof questions != 'object')\r\n    throw new Error('Please give an object with questions')\r\n\r\n  const keys = Object.keys(/** @type {!Object} */ (questions))\r\n  const res = await keys.reduce(async (acc, key) => {\r\n    const accRes = await acc\r\n\r\n    const value = questions[key]\r\n    /** @type {!_reloquent.Question} */\r\n    let question\r\n    switch (typeof value) {\r\n    case 'object':\r\n      question = /** @type {!_reloquent.Question} */ ({ ...value })\r\n      break\r\n    case 'string':\r\n      question = { text: value }\r\n      break\r\n    default:\r\n      throw new Error('A question must be a string or an object.')\r\n    }\r\n\r\n    question.text = `${question.text}${question.text.endsWith('?') ? '' : ':'} `\r\n\r\n    let defaultValue\r\n    let gotDefaultValue\r\n    if (question.defaultValue) {\r\n      defaultValue = question.defaultValue\r\n    }\r\n    if (question.getDefault) {\r\n      gotDefaultValue = await question.getDefault()\r\n    }\r\n\r\n    let dv = defaultValue || ''\r\n    if (defaultValue && gotDefaultValue && defaultValue != gotDefaultValue) {\r\n      dv = c(defaultValue)\r\n    } else if (defaultValue && defaultValue == gotDefaultValue) {\r\n      dv = ''\r\n    }\r\n    let gtd = gotDefaultValue || ''\r\n    const text = `${question.text}${dv ? `[${dv}] ` : ''}${gtd ? `[${gtd}] ` : ''}`\r\n    const { 'promise': promise } = ask(text, {\r\n      timeout,\r\n      password: question.password,\r\n      ...question,\r\n    })\r\n\r\n    const a = await promise\r\n    let answer = a || gotDefaultValue || question.defaultValue\r\n\r\n    if (typeof question.validation == 'function') {\r\n      question.validation(answer)\r\n    }\r\n    if (typeof question.postProcess == 'function') {\r\n      answer = await question.postProcess(answer)\r\n    }\r\n    return {\r\n      ...accRes,\r\n      [key]: answer,\r\n    }\r\n  }, {})\r\n\r\n  return res\r\n}\r\n\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('../..').Questions} _reloquent.Questions\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('../..').Question} _reloquent.Question\r\n */","import '../types/externs'\r\nimport askQuestions, { askSingle, confirm } from './'\r\n\r\nmodule.exports = {\r\n  '_askSingle': askSingle,\r\n  '_confirm': confirm,\r\n  '_askQuestions': askQuestions,\r\n}","import askQuestions from './lib/ask-questions'\r\n\r\n/**\r\n * @type {_reloquent.askQuestions}\r\n */\r\nexport default async function reloquent(questions, timeout) {\r\n  const res = await askQuestions(questions, timeout)\r\n  return res\r\n}\r\n\r\n/**\r\n * @type {_reloquent.askSingle}\r\n */\r\nexport async function askSingle(question, timeout) {\r\n  const { question: answer } = await askQuestions({ question }, timeout)\r\n  return answer\r\n}\r\n\r\n/**\r\n * @type {_reloquent.confirm}\r\n */\r\nexport async function confirm(question, options = {}) {\r\n  const {\r\n    defaultYes = true,\r\n    timeout,\r\n  } = options\r\n  const Q = typeof question == 'string' ? {\r\n    text: question,\r\n  } : question\r\n  const { text } = Q\r\n  const hasQ = text.endsWith('?')\r\n  const realText = `${hasQ ? text.replace(/\\?$/, '') : text} (y/n)${hasQ ? '?' : ''}`\r\n  const { question: answer } = await askQuestions({\r\n    question: {\r\n      defaultValue: defaultYes ? 'y' : 'n',\r\n      ...Q,\r\n      text: realText,\r\n    },\r\n  }, timeout)\r\n  return answer == 'y'\r\n}\r\n\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('..').ConfirmOptions} _reloquent.ConfirmOptions\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('..').Question} _reloquent.Question\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('..').Questions} _reloquent.Questions\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('../types').askSingle} _reloquent.askSingle\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('../types').confirm} _reloquent.confirm\r\n */\r\n/**\r\n * @suppress {nonStandardJsDocs}\r\n * @typedef {import('../types').askQuestions} _reloquent.askQuestions\r\n */\r\n"],
"names":["createInterface","readline","createTimeout","desc","timeout","cb","setTimeout","err","Error","message","stack","makeTimeoutPromise","to","promise","Promise","_","reject","createPromiseWithTimeout","toPromise","race","clearTimeout","ask","question","options","password","output","process","stdout","input","stdin","rest","rl","o","s","includes","write","v","split","length","repeat","p","bind","promto","tryPromise","res","close","askQuestions","questions","Object","keys","reduce","acc","key","accRes","value","text","endsWith","gotDefaultValue","defaultValue","getDefault","dv","gtd","answer","a","validation","postProcess","module","exports","askSingle","confirm","defaultYes","Q","hasQ","realText","replace","reloquent"]
}
